  –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...
  –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.
  DigitalMe -> C:\Sources\DigitalMe\DigitalMe\bin\Debug\net8.0\DigitalMe.dll
  DigitalMe.Tests.Unit -> C:\Sources\DigitalMe\tests\DigitalMe.Tests.Unit\bin\Debug\net8.0\DigitalMe.Tests.Unit.dll
  DigitalMe.Web -> C:\Sources\DigitalMe\src\DigitalMe.Web\bin\Debug\net8.0\DigitalMe.Web.dll
  DigitalMe.Tests.Integration -> C:\Sources\DigitalMe\tests\DigitalMe.Tests.Integration\bin\Debug\net8.0\DigitalMe.Tests.Integration.dll
–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è C:\Sources\DigitalMe\tests\DigitalMe.Tests.Integration\bin\Debug\net8.0\DigitalMe.Tests.Integration.dll (.NETCoreApp,Version=v8.0)
–í–µ—Ä—Å–∏—è VSTest 17.11.1 (x64)

–ó–∞–ø—É—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤; –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (1), —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É.
C:\Sources\DigitalMe\tests\DigitalMe.Tests.Integration\bin\Debug\net8.0\DigitalMe.Tests.Integration.dll
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.5.3.1+6b60a9e56a (64-bit .NET 8.0.17)
[xUnit.net 00:00:00.07]   Discovering: DigitalMe.Tests.Integration
[xUnit.net 00:00:00.11]   Discovered:  DigitalMe.Tests.Integration
[xUnit.net 00:00:00.11]   Starting:    DigitalMe.Tests.Integration
DEBUG FACTORY: ConfigureServices called - this runs BEFORE Program.cs
[21:09:55 INF] Registered tool: store_memory - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å {"SourceContext": "DigitalMe.Services.Tools.ToolRegistry"}
[21:09:55 INF] üîß TOOL REGISTRY INITIALIZED with 1 strategies {"SourceContext": "Program"}
[21:09:55 INF] üöÄ APPLICATION BUILD COMPLETED - Starting migration check {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 1: Creating service scope for migrations {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 2: Service scope created successfully {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 3: Getting DigitalMeDbContext from services {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 4: DbContext retrieved successfully {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 5: Getting logger from services {"SourceContext": "Program"}
[21:09:55 INF] üîç STEP 6: Logger retrieved successfully {"SourceContext": "Program"}
[21:09:55 INF] üîç Starting database migration check... {"SourceContext": "DigitalMe.Services.Database.DatabaseMigrationService"}
[21:09:55 INF] üîç Checking database provider... {"SourceContext": "DigitalMe.Services.Database.DatabaseMigrationService"}
[21:09:55 INF] üîç Database provider is InMemory: True {"SourceContext": "DigitalMe.Services.Database.DatabaseMigrationService"}
[21:09:55 INF] üîç InMemory database detected - using EnsureCreated instead of migrations {"SourceContext": "DigitalMe.Services.Database.DatabaseMigrationService"}
[21:09:55 INF] ‚úÖ InMemory database created: True {"SourceContext": "DigitalMe.Services.Database.DatabaseMigrationService"}
[21:09:55 INF] üß™ STEP 16: Skipping Ivan's personality seeding in Test environment for test isolation {"SourceContext": "Program"}
[21:09:55 INF] ‚úÖ MIGRATION SCOPE DISPOSED - Migration check completed {"SourceContext": "Program"}
[21:09:55 INF] ‚úÖ MIGRATION SECTION COMPLETED - Proceeding to secrets validation and middleware {"SourceContext": "Program"}
[21:09:55 INF] üîê SECRETS VALIDATION: Starting configuration validation... {"SourceContext": "Program"}
[21:09:55 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'ANTHROPIC_API_KEY' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:55 INF] üîß .NET Environment.GetEnvironmentVariable('ANTHROPIC_API_KEY') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:55 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'ANTHROPIC_APIKEY' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:55 INF] üîß .NET Environment.GetEnvironmentVariable('ANTHROPIC_APIKEY') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 WRN] Secret 'Anthropic:ApiKey' not found in configuration or environment variables {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'JWT_KEY' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß .NET Environment.GetEnvironmentVariable('JWT_KEY') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'JWT_KEY' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß .NET Environment.GetEnvironmentVariable('JWT_KEY') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 WRN] Secret 'JWT:Key' not found in configuration or environment variables {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'GITHUB_TOKEN' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß .NET Environment.GetEnvironmentVariable('GITHUB_TOKEN') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'INTEGRATIONS_GITHUB_PERSONALACCESSTOKEN' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß .NET Environment.GetEnvironmentVariable('INTEGRATIONS_GITHUB_PERSONALACCESSTOKEN') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 WRN] Secret 'Integrations:GitHub:PersonalAccessToken' not found in configuration or environment variables {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'TELEGRAM_BOT_TOKEN' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:56 INF] üîß .NET Environment.GetEnvironmentVariable('TELEGRAM_BOT_TOKEN') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'INTEGRATIONS_TELEGRAM_BOTTOKEN' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß .NET Environment.GetEnvironmentVariable('INTEGRATIONS_TELEGRAM_BOTTOKEN') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 WRN] Secret 'Integrations:Telegram:BotToken' not found in configuration or environment variables {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'GOOGLE_CLIENT_SECRET' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß .NET Environment.GetEnvironmentVariable('GOOGLE_CLIENT_SECRET') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß BLOCKER #2 FIX: Attempting to get environment variable 'INTEGRATIONS_GOOGLE_CLIENTSECRET' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 INF] üîß .NET Environment.GetEnvironmentVariable('INTEGRATIONS_GOOGLE_CLIENTSECRET') = 'null' {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 WRN] Secret 'Integrations:Google:ClientSecret' not found in configuration or environment variables {"SourceContext": "DigitalMe.Services.Configuration.SecretsManagementService"}
[21:09:57 ERR] ‚ùå SECRETS VALIDATION FAILED: 2 missing secrets, 0 weak secrets {"SourceContext": "Program"}
[21:09:57 ERR]    Missing: Anthropic:ApiKey (or ANTHROPIC_API_KEY) {"SourceContext": "Program"}
[21:09:57 ERR]    Missing: JWT:Key (or JWT_KEY) {"SourceContext": "Program"}
[21:09:57 INF] Environment check: IsSecure=False, IsTest=True, HasMissing=True {"SourceContext": "Program"}
[21:09:57 WRN] ‚ö†Ô∏è SECRETS: Optional secret 'Integrations:GitHub:PersonalAccessToken' not configured - some integrations may not work {"SourceContext": "Program"}
[21:09:57 WRN] ‚ö†Ô∏è SECRETS: Optional secret 'Integrations:Telegram:BotToken' not configured - some integrations may not work {"SourceContext": "Program"}
[21:09:57 WRN] ‚ö†Ô∏è SECRETS: Optional secret 'Integrations:Google:ClientSecret' not configured - some integrations may not work {"SourceContext": "Program"}
[21:09:57 INF] üí° SECURITY: Development environment - consider using User Secrets for sensitive configuration {"SourceContext": "Program"}
[21:09:57 INF] üîç CRITICAL CHECKPOINT: About to start Telegram initialization - this log should always appear {"SourceContext": "Program"}
[21:09:57 INF] üöÄ TELEGRAM BOT: REACHED TELEGRAM INITIALIZATION BLOCK {"SourceContext": "Program"}
[21:09:57 INF] üöÄ TELEGRAM BOT: Starting initialization process... {"SourceContext": "Program"}
[21:09:57 INF] üîç TELEGRAM BOT: Creating service scope... {"SourceContext": "Program"}
[21:09:57 INF] üîç TELEGRAM BOT: TelegramService resolved successfully {"SourceContext": "Program"}
[21:09:57 INF] üîç TELEGRAM BOT: Configuration resolved successfully {"SourceContext": "Program"}
[21:09:57 INF] üîç TELEGRAM BOT: Logger resolved successfully {"SourceContext": "Program"}
[21:09:57 INF] üîç TELEGRAM BOT: Bot token retrieved: False {"SourceContext": "Program"}
[21:09:57 INF] ‚ÑπÔ∏è TELEGRAM BOT: No valid bot token configured - skipping initialization {"SourceContext": "Program"}
[21:09:57 WRN] Tool store_memory is already registered, replacing with new implementation {"SourceContext": "DigitalMe.Services.Tools.ToolRegistry"}
[21:09:57 INF] Registered tool: store_memory - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å {"SourceContext": "DigitalMe.Services.Tools.ToolRegistry"}
[21:09:57 INF] üîß TEST TOOL REGISTRY INITIALIZED with 1 strategies {"SourceContext": "DigitalMe.Tests.Integration.CustomWebApplicationFactory"}
[21:09:57 INF] üß™ IVAN PERSONALITY SEEDING SKIPPED - test expects missing personality {"SourceContext": "DigitalMe.Tests.Integration.CustomWebApplicationFactory"}
[21:10:02 INF] New connection established: l5eEkyI-8lTG6y5jLxclnA from ["Microsoft SignalR/8.0 (8.0.8+954f61dd38b33caa2b736c73530bd5a294174437; Windows NT; .NET; .NET 8.0.17)"] {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] üëã User test-user-123 joined chat from Web (Connection: l5eEkyI-8lTG6y5jLxclnA) {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] üöÄ ChatHub.SendMessage STARTED - UserId: test-user-123, Platform: Web, Message: 'Hello Ivan!' {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] üìù Processing user message for UserId: test-user-123, Platform: Web {"SourceContext": "DigitalMe.Services.MessageProcessor", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] ‚úÖ Conversation ID 15b0e3f8-1b21-4fe4-adcb-5a9e06382b5e created/found {"SourceContext": "DigitalMe.Services.MessageProcessor", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] ‚úÖ User message 1c7071f1-720c-495f-9d3d-d11f142596e2 added {"SourceContext": "DigitalMe.Services.MessageProcessor", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] üì° STEP 3: Notifying group chat_test-user-123 about user message {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] ‚è≥ STEP 4: Showing typing indicator for group chat_test-user-123 {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 INF] üß† Processing agent response for ConversationId: 15b0e3f8-1b21-4fe4-adcb-5a9e06382b5e {"SourceContext": "DigitalMe.Services.MessageProcessor", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 WRN] Ivan's personality profile not found in database {"SourceContext": "DigitalMe.Services.MVPPersonalityService", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 ERR] ‚ùå Ivan's personality profile not found! {"SourceContext": "DigitalMe.Services.MessageProcessor", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[21:10:02 ERR] üí• Background processing FAILED for user test-user-123: Ivan's personality profile not found. Please create it first. {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
DigitalMe.Common.Exceptions.PersonalityServiceException: Ivan's personality profile not found. Please create it first.
   at DigitalMe.Services.MessageProcessor.ProcessAgentResponseAsync(ChatRequestDto request, Guid conversationId) in C:\Sources\DigitalMe\DigitalMe\Services\MessageProcessor.cs:line 73
   at DigitalMe.Hubs.ChatHub.ProcessAgentResponseAsync(ChatRequestDto request, Guid conversationId, String groupName) in C:\Sources\DigitalMe\DigitalMe\Hubs\ChatHub.cs:line 115
[21:10:02 INF] üéâ ChatHub.SendMessage COMPLETED (background processing started) for user test-user-123 {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
     Warning:
     The component "Fluent Assertions" is governed by the rules defined in the Xceed License Agreement and
     the Xceed Fluent Assertions Community License. You may use Fluent Assertions free of charge for
     non-commercial use only. An active subscription is required to use Fluent Assertions for commercial use.
     Please contact Xceed Sales mailto:sales@xceed.com to acquire a subscription at a very low cost.
     A paid commercial license supports the development and continued increasing support of
     Fluent Assertions users under both commercial and community licenses. Help us
     keep Fluent Assertions at the forefront of unit testing.
     For more information, visit https://xceed.com/products/unit-testing/fluent-assertions/
DEBUG ERROR STRUCTURE: {
  "message": "\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0435 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F. \u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0441\u043D\u043E\u0432\u0430.",
  "code": "PROCESSING_ERROR",
  "details": "Ivan\u0027s personality profile not found. Please create it first."
}
[xUnit.net 00:00:12.30]     DigitalMe.Tests.Integration.ChatFlowTests.ChatFlow_WithoutIvanPersonality_ShouldReturnError [FAIL]
[xUnit.net 00:00:12.30]       Expected error.TryGetProperty("Code", out var codeElement) to be True because Error object should contain 'Code' property, but found False.
[xUnit.net 00:00:12.31]       Stack Trace:
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.LateBoundTestFramework.Throw(String message)
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.AssertionScope.AddPreFormattedFailure(String formattedFailureMessage)
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.AssertionChain.FailWith(Func`1 getFailureReason)
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.AssertionChain.FailWith(Func`1 getFailureReason)
[xUnit.net 00:00:12.31]            at FluentAssertions.Execution.AssertionChain.FailWith(String message, Object[] args)
[xUnit.net 00:00:12.31]            at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
[xUnit.net 00:00:12.31]         C:\Sources\DigitalMe\tests\DigitalMe.Tests.Integration\ChatFlowTests.cs(191,0): at DigitalMe.Tests.Integration.ChatFlowTests.ChatFlow_WithoutIvanPersonality_ShouldReturnError()
[xUnit.net 00:00:12.31]         --- End of stack trace from previous location ---
[21:10:07 INF] Connection l5eEkyI-8lTG6y5jLxclnA disconnected. Exception: null {"SourceContext": "DigitalMe.Hubs.ChatHub", "TransportConnectionId": "l5eEkyI-8lTG6y5jLxclnA", "RequestId": "0HNFFOEQ51U1K", "RequestPath": "/chathub"}
[xUnit.net 00:00:12.31]   Finished:    DigitalMe.Tests.Integration
  –ù–µ –ø—Ä–æ–π–¥–µ–Ω DigitalMe.Tests.Integration.ChatFlowTests.ChatFlow_WithoutIvanPersonality_ShouldReturnError [12 s]
  –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ:
   Expected error.TryGetProperty("Code", out var codeElement) to be True because Error object should contain 'Code' property, but found False.
  –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç–µ–∫–∞:
     at FluentAssertions.Execution.LateBoundTestFramework.Throw(String message)
   at FluentAssertions.Execution.DefaultAssertionStrategy.HandleFailure(String message)
   at FluentAssertions.Execution.AssertionScope.AddPreFormattedFailure(String formattedFailureMessage)
   at FluentAssertions.Execution.AssertionChain.FailWith(Func`1 getFailureReason)
   at FluentAssertions.Execution.AssertionChain.FailWith(Func`1 getFailureReason)
   at FluentAssertions.Execution.AssertionChain.FailWith(String message, Object[] args)
   at FluentAssertions.Primitives.BooleanAssertions`1.BeTrue(String because, Object[] becauseArgs)
   at DigitalMe.Tests.Integration.ChatFlowTests.ChatFlow_WithoutIvanPersonality_ShouldReturnError() in C:\Sources\DigitalMe\tests\DigitalMe.Tests.Integration\ChatFlowTests.cs:line 191
--- End of stack trace from previous location ---

–°–±–æ–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 1
     –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ: 1
 –û–±—â–µ–µ –≤—Ä–µ–º—è: 12.8548 –°–µ–∫—É–Ω–¥—ã
