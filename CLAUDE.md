# CLAUDE.md - Проект DigitalMe

## Текущий проект: Создание цифрового клона Ивана

### Цель
Создание персонализированного LLM-агента, который максимально точно моделирует личность, мышление, ценности и поведенческие паттерны пользователя (Ивана, 34, программист, Head of R&D в EllyAnalytics).

### Текущий статус
**Этап:** Сбор персональных данных через структурированное интервью  
**Прогресс:** Базовая автобиография собрана, ведётся углублённое интервью  
**Структура файлов:**
- `docs/plans/` - планы разработки и стратегии
- `data/profile/IVAN_PROFILE_DATA.md` - накопленные данные о личности  
- `docs/interview/` - материалы интервью и трекинг
- `docs/analysis/IVAN_PERSONALITY_ANALYSIS.md` - психологический анализ
- `feedback/` - заметки для обсуждения и улучшений

### Методология интервью
- **Автобиографический подход** с последующими целевыми вопросами
- **Темпоральное моделирование** - учёт изменений личности во времени
- **Многоаспектные вопросы** - каждый ответ выявляет несколько характеристик
- **Структурированный трекинг** - систематическое покрытие всех аспектов личности

### Ключевые инсайты о субъекте (Иване)
- **Радикальная трансформация:** От армейской стагнации к гипер-продуктивности в IT
- **Основные драйверы:** Финансовая безопасность, избегание "потолка", интересные технические задачи
- **Внутренние конфликты:** Семья vs карьера, настоящее vs будущее
- **Когнитивный стиль:** Структурированное мышление, прагматичный подход к решениям
- **Технические предпочтения:** C#/.NET, строгая типизация, избегание графических инструментов

---

## Система динамического применения правил

Этот проект использует систему динамического применения правил из `.cursor/rules`, аналогично Cursor AI. Правила классифицированы по типам применения и автоматически подгружаются на основе контекста и ключевых слов.

## Классификация правил

### 1. Глобальные правила (alwaysApply: true)

Применяются к КАЖДОМУ запросу автоматически:

- **main.mdc** - Основные архитектурные принципы фреймворка
- **aggro.mdc** - Безжалостно честный советник

### 2. Правила по паттернам файлов (globs)

Автоматически применяются при работе с файлами соответствующих типов:

#### C# код (*.cs, *.csproj, *.sln)
- **csharp-codestyle.mdc** - Правила кодстайла для C#
- **general-coding.mdc** - Общие правила написания кода

#### Razor файлы (*.razor)
- **razor-codestyle.mdc** - Правила для Razor компонентов

#### Все файлы (**)
- **codestyle.mdc** - Общие правила кодстайла
- **general-codestyle.mdc** - Универсальные принципы

### 3. Динамические правила (по ключевым словам и контексту)

Применяются автоматически при обнаружении соответствующих ключевых слов в запросе:

#### Планирование и управление планами
- **TDD-Plan-Generator-new.mdc**
  - Ключевые слова: "план", "планирование", "roadmap", "work plan", "дорожная карта"
  - Описание: Применять при создании плана создания нового проекта или функционала

- **common-plan-generator.mdc**
  - Ключевые слова: "план", "планирование", "начнём с планирования", "запланируем"
  - Описание: Применять при создании любого файла плана работ

- **common-plan-executor.mdc**
  - Ключевые слова: "исполнение плана", "выполнение плана", "реализация плана", "execute plan"
  - Описание: Применять при исполнении любого файла плана работ

- **common-plan-reviewer.mdc**
  - Ключевые слова: "ревью плана", "проверка плана", "соответствие плана", "валидация плана"
  - Описание: Применять при ревью планов на соответствие правилам

- **systematic-review.mdc**
  - Ключевые слова: "ревью структуры", "проверка планов", "валидация структуры", "systematic review"
  - Описание: Применять при систематическом ревью структуры планов

- **каталогизация-правила.mdc**
  - Ключевые слова: "каталогизация", "структура файлов", "создать каталог", "организация плана"
  - Описание: Применять при решении вопросов каталогизации в планах

#### Отладка и исправление багов
- **TDD-Bug-Fixing.mdc**
  - Ключевые слова: "баг", "регрессия", "не работает", "проблема", "ошибка", "критический", "production"
  - Описание: Применять TDD методологию для исправления багов через failing тесты

#### Создание планов для любых задач
- **common-plan-generator.mdc**
  - Ключевые слова: "составить план", "составим план", "запланируем", "создать план", "план работ", "план действий", "план исправления", "план решения", "план лечения", "планирование", "разработка плана", "нужен план", "давай план", "сделаем план"
  - Автоактивация: При любых запросах создания планов - исправления проблем, разработки функций, решения задач, структурирования работ
  - Описание: ВСЕГДА использовать для создания структурированных планов для ЛЮБЫХ задач - технических проблем, разработки, исправлений, внедрения функций

#### Работа с терминалом
- **terminal-management.mdc**
  - Ключевые слова: "git", "терминал", "команда зависла", "timeout", "PowerShell", "cmd"
  - Автоактивация: При зависании команд >15 секунд, ошибках типа 'command not found' с лишними символами
  - Описание: Применять при работе с терминалом/командной строкой

#### Дополнительные системные правила
- **systematic-review.mdc**
  - Ключевые слова: "ревью структуры", "проверка планов", "валидация структуры", "systematic review", "структурный анализ"
  - Автоактивация: При обнаружении нарушений структуры планов или при явном запросе ревью
  - Описание: Применять при систематическом ревью структуры планов работ

- **каталогизация-правила.mdc**
  - Ключевые слова: "каталогизация", "структура файлов", "создать каталог", "организация плана", "единственный файл в каталоге"
  - Описание: Применять при решении вопросов каталогизации в планах работ - КОГДА создавать каталоги, а когда это over-engineering

- **parallel-plan-executor.mdc**
  - Ключевые слова: "параллельное выполнение", "распараллелить план", "независимые задачи", "потоки работы", "concurrent execution"
  - Описание: Применять для создания параллельных потоков выполнения плана на основе анализа зависимостей

## Система применения правил

### Автоматическое применение

1. **При каждом запросе**:
   - Загружаются глобальные правила (alwaysApply: true)
   - Анализируется тип файлов в контексте
   - Применяются соответствующие правила по globs

2. **При обнаружении ключевых слов**:
   - Сканируется запрос пользователя на наличие ключевых слов
   - Автоматически подгружаются соответствующие динамические правила
   - При неуверенности - запрашивается подтверждение у пользователя

3. **При определенных условиях**:
   - Некоторые правила активируются автоматически при определенных событиях
   - Например, terminal-management.mdc при зависании команд

### Принципы динамической загрузки

1. **Минимизация контекста**: Загружаются только релевантные правила
2. **Контекстная релевантность**: Правила выбираются на основе текущей задачи
3. **Избегание перегрузки**: Не загружаются все правила сразу
4. **Приоритизация**: Глобальные правила имеют высший приоритет

### Примеры применения

#### Запрос: "Создаем план интеграции нового API"
Автоматически применятся:
- main.mdc (глобальное)
- aggro.mdc (глобальное)  
- common-plan-generator.mdc (ключевое слово "план")
- TDD-Plan-Generator-new.mdc (ключевое слово "план")

#### Запрос: "Исправим баг в авторизации"
Автоматически применятся:
- main.mdc (глобальное)
- aggro.mdc (глобальное)
- TDD-Bug-Fixing.mdc (ключевое слово "баг")

#### Запрос: "Давай составим план лечения этих проблем компиляции"
Автоматически применятся:
- main.mdc (глобальное)
- aggro.mdc (глобальное)
- common-plan-generator.mdc (ключевые слова "составим план", "план лечения")

#### Работа с файлом Example.cs
Автоматически применятся:
- main.mdc (глобальное)
- aggro.mdc (глобальное)
- csharp-codestyle.mdc (глоб паттерн *.cs)
- general-coding.mdc (глоб паттерн *.cs)
- codestyle.mdc (глоб паттерн **)

## Инструменты автоматизации

В `.cursor/tools/` находятся скрипты для автоматизированной работы с планами:

- **PlanStructureValidator.ps1** - Валидация структуры планов
- **AutomatedReviewSystem.ps1** - Автоматическое исправление нарушений
- **QuickReviewFix.ps1** - Экспресс-исправления
- **DemoAutomation.ps1** - Демонстрация автоматизации

Эти инструменты автоматически используются соответствующими правилами.

## Настройка и расширение

### Добавление нового правила

1. Создать файл `.cursor/rules/new-rule.mdc`
2. Добавить заголовок с метаданными:
   ```yaml
   ---
   description: Описание применения правила и ключевые слова
   globs: *.ext (если применимо)
   alwaysApply: false/true
   ---
   ```
3. Описать логику применения в description
4. Правило автоматически станет доступным

### Модификация существующих правил

Правила можно модифицировать, изменяя:
- description (ключевые слова для активации)
- globs (паттерны файлов)
- alwaysApply (глобальное применение)
- содержимое правила

## Принципы эффективного использования

1. **Используй описательные запросы**: Включай ключевые слова для автоматической активации правил
2. **Доверяй системе**: Правила подгружаются автоматически на основе контекста
3. **Уточняй при неуверенности**: Система запросит подтверждение при двусмысленности
4. **Следуй иерархии**: Глобальные правила всегда применяются, специфические дополняют их

---

## Фреймворк параллельного выполнения планов

**Реализован в**: `@parallel-plan-executor.mdc` + **parallel-plan-optimizer** субагент

Система автоматического распараллеливания планов на основе анализа зависимостей задач. Создает независимые flows выполнения для максимального ускорения реализации.

**Когда применять**:
- По запросу пользователя на оптимизацию планов

**Ключевые слова активации**: "параллельное выполнение", "распараллелить план", "независимые задачи", "потоки работы", "оптимизация времени"

**Субагент**: `parallel-plan-optimizer` - специализированный агент для анализа зависимостей, построения матрицы блокировок и генерации оптимальных параллельных flows

**Результат**: Мета-план с параллельными flows, матрица зависимостей, синхронизационные точки, оценка ускорения выполнения.

---

**Цель**: Обеспечить автоматическое применение релевантных правил без перегрузки контекста, максимально используя принципы Cursor AI для эффективной работы с кодовой базой.